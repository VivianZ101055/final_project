---
title: "final_project"
author: "Vivian Zhang"
date: "2/27/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(janitor)
library(tidyverse)
library(rvest)
library(magrittr)
library(base)
library(plyr)

```

```{r member states}

eu_members <- read_html('https://en.wikipedia.org/wiki/Member_state_of_the_European_Union', skip = 0)

eumemberinfo <- eu_members %>%
  html_nodes(xpath='//*[@id="mw-content-text"]/div/table[5]') %>%
  html_table()

eumemberinfo <- eumemberinfo[[1]]

# Removing Wikipedia annotations

eumemberinfo$Name <- str_remove_all(eumemberinfo$Name, "\\[.*\\]")

# Changing the names because Eastern European countries are labeled
# differently on the two datasets

eumemberinfo$Name[eumemberinfo$Name == "Czechia"] <- "Czech Republic"

eumemberinfo$Name[eumemberinfo$Name == "Slovakia"] <- "Slovak Republic"

```

```{r dataset, include=FALSE}

# Load remittances in USD in a given country, in alphabetical order

usd <- read_excel("data/remittances_usd.xls", skip = 3) %>%
  clean_names() %>% 
  arrange(country_name)

# Trying to get rid of the x in front of the data
# Filter to only show between 1980 to present
# Repeatedly getting the error that argument "pattern" is missing, with no
# default
# Convert USD to Euros - maybe later

# usd <- usd %>%
#   pivot_longer(
#     cols = starts_with("x"),
#     names_to = "year",
#     names_prefix = "yr"
#                )

# usd$year <- gsub("^.{0,1}", "", usd$year)

# usd$year <- as.numeric(usd$year)

# usd <- usd %>%
#   pivot_wider(
#     id_cols = is.numeric(usd),
#     names_to = "year",
#     names_prefix = "yr"
#                )

# pivot_wider(data, id_cols = NULL, names_from = name,
#   names_prefix = "", names_sep = "_", names_repair = "check_unique",
#   values_from = value, values_fill = NULL, values_fn = NULL)

# usd <- usd %>%
#   select(colnames(usd), str_split("x"))

# usd <- usd %>%
#   pivot_longer(
#     cols = starts_with("x"),
#     names_to = "year",
#     names_prefix = "yr"
#                )

# usd <- usd %>%
#   pivot_longer(
#     cols = starts_with("x"),
#     names_to = "year",
#     names_prefix = "yr"
#                )
# 
# usd$year <- gsub("^.{0,1}", "", usd$year)
# 
# usd$year <- as.numeric(usd$year)

# join this with the eumemberinfo to only look at member states

full_data <- usd %>%
  inner_join(eumemberinfo, by = c("country_name" = "Name"))

# Load remittances as percentage of GDP for a given country

percent_gdp <- read_excel("data/remittance_percentgdp.xls", skip = 3) %>%
  clean_names()

# percent_gdp <- percent_gdp %>%
#   pivot_longer(
#     cols = starts_with("x"),
#     names_to = "year",
#     names_prefix = "yr"
#                )

# Join this with the previous data and select only the relevant columns

full_data <- full_data %>%
  inner_join(percent_gdp, by = "country_name", suffix = c("_usd", "_gdp")) %>%
  select(country_name, country_code_gdp, starts_with("x"))

# full_data <- sub("^[^1|2]+\\.", "", full_data)

# full_data <- substr(paris$ratification, 0, 4)

```

```{r}

remittance_inflows <- read_excel("data/remittance_inflows.xlsx", skip = 0) %>%
  clean_names()

full_data <- full_data %>%
  inner_join(remittance_inflows, by = c("country_name" = "migrant_remittance_inflows_us_million"))

```

